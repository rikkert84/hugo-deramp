{{ define "main" }}
<h1>Alle Plaatsen ({{ len $.Data.Terms }})</h1>

<!-- Interactieve Zeeland kaart -->
<div id="zeeland-map" style="height: 600px; width: 100%; margin: 2rem 0;"></div>

<!-- Lijst plaatsen -->
<div class="plaatsen-lijst">
  {{ range $.Data.Terms.ByCount }}
    <div class="plaats-item">
      <h3><a href="{{ .Page.Permalink }}">{{ .Page.Title }}</a></h3>
      <p>{{ .Page.Description | plainify }}</p>
      <span class="slachtoffers">{{ .Count }} slachtoffers</span>
    </div>
  {{ end }}
</div>

<!-- Leaflet CSS/JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const plaatsen = [
{{ range $.Data.Terms }}
  {
    naam: "{{ .Page.Title | safeJS }}",
    lat: {{ .Page.Params.coördinaten | split "," | first | strings.TrimSpace | float }},
    lng: {{ .Page.Params.coördinaten | split "," | last | strings.TrimSpace | float }},
    url: "{{ .Page.Permalink | safeJS }}"
  },
{{ end }}
];

// Debug: console.log(plaatsen);
console.log('Plaatsen data:', plaatsen);

const map = L.map('zeeland-map').setView([51.5, 3.8], 10);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

// Veilige marker toevoeging
plaatsen.forEach(plaats => {
  if (!isNaN(plaats.lat) && !isNaN(plaats.lng)) {
    L.marker([plaats.lat, plaats.lng])
      .bindPopup(`
        <h4><a href="${plaats.url}">${plaats.naam}</a></h4>
        <p>Klik voor details</p>
      `)
      .addTo(map);
  } else {
    console.warn('Ongeldige coördinaten voor', plaats.naam, plaats.lat, plaats.lng);
  }
});
</script>

{{ end }}
