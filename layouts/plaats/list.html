{{ define "main" }}
<h1>Getroffen plaatsen</h1>
</br>

<!-- Interactieve Zeeland kaart -->
<div id="zeeland-map" style="height: 600px; margin-bottom: 2rem;"></div>

<div class="plaatsen-lijst">
  {{ range .Pages.GroupByParam "provincie" "asc" }}
    <h3>{{ .Key }}</h3>
    <p>
      {{ range $index, $page := sort .Pages "LinkTitle" "asc" }}
        {{ if $index }} | {{ end }}
        <a href="{{ $page.Permalink }}">{{ $page.Title }}</a>
      {{ end }}
    </p> </br>
  {{ end }}
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map('zeeland-map').setView([51.65, 4.05], 9);

// Positron (sober wit/grijs)
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
  maxZoom: 18
}).addTo(map);

// Zoom uitknop
const overviewBtn = L.Control.extend({
  onAdd: function(map) {
    const btn = L.DomUtil.create('div', 'leaflet-bar leaflet-control overview-btn');
    btn.innerHTML = '↖️';
    btn.style.background = 'white';
    btn.style.padding = '8px 12px';
    btn.style.borderRadius = '4px';
    btn.style.cursor = 'pointer';
    btn.style.fontSize = '12px';
    btn.style.boxShadow = '0 2px 5px rgba(0,0,0,0.3)';
    btn.onclick = () => map.setView([51.65, 4.05], 9);
    return btn;
  }
});
new overviewBtn({ position: 'topleft' }).addTo(map);

//geojson gebieden ophalen
fetch('/data/gebieden.geojson')
  .then(response => response.json())
  .then(data => {
    L.geoJSON(data, {
      style: function(feature) {
        return {
          color: '#4a90e2',
          weight: 1.5,
          fillColor: '#4a90e2',
          fillOpacity: 0.25,
          opacity: 0.9
        };
      },
 //     onEachFeature: function(feature, layer) {
 //       layer.bindPopup(`<b>${feature.properties.name}</b><br>${feature.properties.slachtoffers} slachtoffers`);
 //     }
    }
  ).addTo(map);
  });



  
// Sober marker icon
const soberIcon = L.divIcon({
  html: '<div style="background:#333; width:8px; height:8px; border-radius:50%; border:1px solid #666;"></div>',
  iconSize: [10, 10],
  iconAnchor: [5, 5],
  popupAnchor: [0, -10],
  className: 'custom-marker'
});

// Dynamische markers
{{ range .Pages }}
  {{ $coords := .Params.coördinaten }}
  {{ if $coords }}
    {{ $parts := split $coords " " }}
    {{ if ge (len $parts) 2 }}
      {{ $lat := (index $parts 0 | strings.TrimSpace | float) }}
      {{ $lng := (index $parts 1 | strings.TrimSpace | float) }}
      {{ if and (ge $lat 50) (le $lat 54) }}
        L.marker([{{$lat}}, {{$lng}}], { icon: soberIcon })
          .bindPopup(`
            <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
            <p>
            {{ $aantal := .Params.aantal_slachtoffers | default 0 }}
            {{ if eq $aantal 0 }}Geen slachtoffers
            {{ else if eq $aantal 1 }}Eén slachtoffer
            {{ else }}{{ $aantal }} slachtoffers
            {{ end }}
            </p>
          `)
          .addTo(map);
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

//console.log('Markers toegevoegd: {{ len .Pages }} plaatsen');

function zoomTo(coordsStr) {
  const parts = coordsStr.split(' ');
  if (parts.length >= 2) {
    const lat = parseFloat(parts[0].trim());
    const lng = parseFloat(parts[1].trim());
    map.setView([lat, lng], 14);
  }
}
</script>

<style>
.custom-marker {
  background: none !important;
  border: none !important;
  margin: 0 !important;
}
.plaatsen-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
}
.plaats-card {
  padding: 1.5rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  background: white;
}
.badge {
  background: #e74c3c;
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
}
</style>

{{ end }}
