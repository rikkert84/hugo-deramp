{{ define "main" }}
<h1>Slachtoffers Watersnood 1953 ({{ len $.Pages }})</h1>

<!-- Filter UI -->
<div id="namen-filters">
  <input type="text" id="namen-search" placeholder="Zoek op naam...">
  <select id="plaatsen-filter">
    <option value="">Alle plaatsen</option>
{{ $plaatsen := slice }}
{{ range .Paginator.Pages }}  <!-- ← $paginator ipv $.Pages -->
  {{ range .Params.plaatsen }}
    {{ if not (in $plaatsen .) }}
     {{ $plaatsen = $plaatsen | append . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ range $plaatsen }}
  <option value="{{ . | lower }}">{{ . | title }}</option>
{{ end }}
  </select>
</div>

{{ $paginator := .Paginate (.Pages.ByParam "sorteren") 2 }}
<div class="namen-grid">
  {{ range $paginator.Pages }}
    {{ $plaatsenStr := delimit (apply (default (slice) .Params.plaatsen) "lower" ".") "," }}
    <div class="overlijdens-advertentie" 
         data-naam="{{ .Title | lower }}"
         data-plaatsen="{{ $plaatsenStr }}">
      <div class="advertentie-inner">
        <h3 class="naam">{{ .Title }}</h3>
        {{ if or .Params.geboortedatum .Params.geboorteplaats }}
        <div class="geb">
          <strong>Geb.</strong> {{ .Params.geboortedatum | time.AsTime | time.Format "2 Jan 2006" }}
          {{ if .Params.geboorteplaats }} te {{ .Params.geboorteplaats }}{{ end }}
        </div>
        {{ end }}
        <div class="overl">
          <strong>Overleden</strong> te {{ .Params.overlijdensplaats }}
        </div>
        <!-- Badge bij Details -->
        {{ with .Params.herinneringen }}
          {{ if gt (len .) 0 }}
            <span class="herinnering-badge">{{ len . }} herinnering{{ if gt (len .) 1 }}en{{ end }}</span>
          {{ end }}
        {{ end }}
        <a href="{{ .Permalink }}" class="lees-meer">Details →</a>
      </div>
    </div>
  {{ end }}
</div>

<!-- Paginatie -->
{{ if ge $paginator.TotalPages 2 }}
  <div class="pagination">
    {{ partial "pagination.html" . }}
  </div>
{{ end }}

<!-- JavaScript & CSS -->

<script>
(function() {
  const searchInput = document.getElementById('namen-search');
  const plaatsSelect = document.getElementById('plaatsen-filter');

  function applyFilter() {
    const items = document.querySelectorAll('.overlijdens-advertentie');
    const q = searchInput.value.toLowerCase().trim();
    const plaats = plaatsSelect.value.toLowerCase();

    items.forEach(item => {
      item.style.display = ''; // Reset eerst
    });

    if (!q && !plaats) return;

    items.forEach(item => {
      const naam = item.dataset.naam || '';
      const plaatsen = item.dataset.plaatsen || '';

      // Exact substring match (case-insensitive)
      const matchNaam = !q || naam.indexOf(q) !== -1;
      const matchPlaats = !plaats || plaatsen.indexOf(plaats) !== -1;

      if (!(matchNaam && matchPlaats)) {
        item.style.display = 'none';
      }
    });
  }

  searchInput.addEventListener('input', applyFilter);
  plaatsSelect.addEventListener('change', applyFilter);
})();
</script>




<style>
.herinnering-badge {
  background: #6c757d;
  color: white;
  padding: 0.2rem 0.5rem;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: bold;
  margin-right: 0.5rem;
  vertical-align: middle;
}
.lees-meer {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

/* Pagination: Grijs/wit, schoon */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
  margin: 2.5rem 0;
  padding: 1rem;
  font-size: 1rem;
  flex-wrap: wrap;
}

.pagination-label {
  color: #6c757d;
  font-weight: 500;
  white-space: nowrap;
}

.pagination-link {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.55rem 0.85rem;
  min-width: 2.2rem;
  height: 2.2rem;
  border: 1px solid #adb5bd;
  border-radius: 0.375rem;
  text-decoration: none;
  font-weight: 500;
  font-size: 0.95rem;
  background: #6c757d;
  color: white !important;
  transition: all 0.15s ease;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.pagination-link:hover {
  background: #5a6268;
  border-color: #545b62;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.pagination-link--current {
  background: #495057;
  color: white !important;
  border-color: #495057;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.pagination-link--prev, .pagination-link--next {
  font-size: 0.9rem;
}

.pagination-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}
</style>

{{ end }}
