{{ define "main" }}
<h1>Getroffen plaatsen</h1>

<!-- Interactieve Zeeland kaart -->
<div id="zeeland-map" style="height: 600px; margin-bottom: 2rem;"></div>

<div class="plaatsen-grid">
{{ range .Pages }}
  <div>
    <h3><a href="{{ .Permalink }}">{{ .Title }}</a>    
    {{ if .Params.co√∂rdinaten }}
      <button onclick="zoomTo('{{ .Params.co√∂rdinaten }}')">üîç</button>
    {{ end }}
    </h3>

    {{ if .Params.provincie }}
      <p><strong>Provincie:</strong> {{ .Params.provincie }}</p>
    {{ end }}

    {{ if .Params.aantal_slachtoffers }}
      <span class="badge">{{ .Params.aantal_slachtoffers }} slachtoffers</span>
    {{ end }}
  </div>
{{ end }}
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map('zeeland-map').setView([51.65, 4.05], 9);

// Positron (sober wit/grijs)
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
  maxZoom: 18
}).addTo(map);

// Zoom uitknop
const overviewBtn = L.Control.extend({
  onAdd: function(map) {
    const btn = L.DomUtil.create('div', 'leaflet-bar leaflet-control overview-btn');
    btn.innerHTML = '‚ÜñÔ∏è';
    btn.style.background = 'white';
    btn.style.padding = '8px 12px';
    btn.style.borderRadius = '4px';
    btn.style.cursor = 'pointer';
    btn.style.fontSize = '12px';
    btn.style.boxShadow = '0 2px 5px rgba(0,0,0,0.3)';
    btn.onclick = () => map.setView([51.65, 4.05], 9);
    return btn;
  }
});
new overviewBtn({ position: 'topleft' }).addTo(map);

 
// Overstromingsgebieden - dunnere rand
//L.polygon([
//  // rest tekenen met https://geojson.io/
//  [51.4899, 3.5896], [51.4814, 3.5971], [51.4763, 3.6096],
//  [51.4697, 3.6364], [51.4693, 3.6657], [51.4779, 3.7007],
//  [51.4849, 3.7400], [51.4860, 3.7768], [51.5000, 3.8143],
//  [51.5144, 3.8549], [51.5373, 3.8530], [51.5478, 3.8368],
//  [51.5455, 3.8130], [51.5439, 3.7918], [51.5493, 3.7612],
//  [51.5439, 3.7406], [51.5260, 3.7288], [51.5140, 3.7032],
//  [51.5253, 3.6851], [51.5474, 3.6776], [51.5555, 3.6564],
//  [51.5493, 3.6333], [51.5183, 3.5896], [51.4899, 3.5896]
//  
//], {
//  color: '#4a90e2',        // ‚Üê Helderblauw ipv donker
//  weight: 1.5,             // ‚Üê 1.5px ipv 3px
//  fillColor: '#4a90e2',
//  fillOpacity: 0.25,
//  opacity: 0.9             // ‚Üê Rand transparant
//}).bindPopup('<b>Nieuwerkerk gebied</b><br>245 slachtoffers').addTo(map);
//einde demo



  
// Sober marker icon
const soberIcon = L.divIcon({
  html: '<div style="background:#333; width:8px; height:8px; border-radius:50%; border:1px solid #666;"></div>',
  iconSize: [10, 10],
  iconAnchor: [5, 5],
  popupAnchor: [0, -10],
  className: 'custom-marker'
});

// Dynamische markers
{{ range .Pages }}
  {{ $coords := .Params.co√∂rdinaten }}
  {{ if $coords }}
    {{ $parts := split $coords " " }}
    {{ if ge (len $parts) 2 }}
      {{ $lat := (index $parts 0 | strings.TrimSpace | float) }}
      {{ $lng := (index $parts 1 | strings.TrimSpace | float) }}
      {{ if and (ge $lat 50) (le $lat 54) }}
        L.marker([{{$lat}}, {{$lng}}], { icon: soberIcon })
          .bindPopup(`
            <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
            <p>{{ .Params.aantal_slachtoffers | default "Geen" }} slachtoffers</p>
          `)
          .addTo(map);
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

console.log('Markers toegevoegd: {{ len .Pages }} plaatsen');

function zoomTo(coordsStr) {
  const parts = coordsStr.split(' ');
  if (parts.length >= 2) {
    const lat = parseFloat(parts[0].trim());
    const lng = parseFloat(parts[1].trim());
    map.setView([lat, lng], 14);
  }
}
</script>

<style>
.custom-marker {
  background: none !important;
  border: none !important;
  margin: 0 !important;
}
.plaatsen-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
}
.plaats-card {
  padding: 1.5rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  background: white;
}
.badge {
  background: #e74c3c;
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
}
</style>

{{ end }}
