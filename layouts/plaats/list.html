{{ define "main" }}
<h1>Plaatsen ({{ len .Pages }})</h1>

<!-- Interactieve Zeeland kaart -->
<div id="zeeland-map" style="height: 600px; margin-bottom: 2rem;"></div>

<div class="plaatsen-grid">
{{ range .Pages }}
  <div class="plaats-card">
    <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
    {{ if .Params.aantal_slachtoffers }}
      <span class="badge">{{ .Params.aantal_slachtoffers }} slachtoffers</span>
    {{ end }}
    {{ if .Params.coördinaten }}
      <button onclick="zoomTo('{{ .Params.coördinaten }}')">Zoom kaart</button>
    {{ end }}
  </div>
{{ end }}
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map('zeeland-map').setView([51.65, 4.05], 9);

// Positron (sober wit/grijs)
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
  maxZoom: 18
}).addTo(map);

//demo

// Overstromingsgebieden - dunnere rand
L.polygon([
  // Middelburg en omstreken getekend met https://geojson.io/
   [
              3.5895803398022395,
              51.489906009733545
            ],
            [
              3.5970709002858996,
              51.48135451146388
            ],
            [
              3.6095553211223432,
              51.47630077022393
            ],
            [
              3.63639692670381,
              51.46969178394207
            ],
            [
              3.6657349569487394,
              51.46930383317766
            ],
            [
              3.7006902988231616,
              51.47785683058882
            ],
            [
              3.7400157628407555,
              51.484853045505616
            ],
            [
              3.776844351883284,
              51.48601916387588
            ],
            [
              3.8142971542998225,
              51.50001025832276
            ],
            [
              3.854871023583769,
              51.514385519916544
            ],
            [
              3.852998383462676,
              51.537298852892405
            ],
            [
              3.8367688357490692,
              51.547780769936054
            ],
            [
              3.8130487275527116,
              51.545451663690784
            ],
            [
              3.791825472849723,
              51.54389885995599
            ],
            [
              3.761239017542863,
              51.54933344119593
            ],
            [
              3.7406399762147373,
              51.54389885995599
            ],
            [
              3.728779922115706,
              51.52603780809886
            ],
            [
              3.703187173798142,
              51.51399705896432
            ],
            [
              3.6850850649723554,
              51.525261370993235
            ],
            [
              3.6775947171774135,
              51.54739298064334
            ],
            [
              3.6563716561852004,
              51.55554382492741
            ],
            [
              3.6332754086272416,
              51.549333494232485
            ],
            [
              3.5895803398022395,
              51.51826994723703
            ],
            [
              3.5895803398022395,
              51.489906009733545
            ]




  
], {
  color: '#4a90e2',        // ← Helderblauw ipv donker
  weight: 1.5,             // ← 1.5px ipv 3px
  fillColor: '#4a90e2',
  fillOpacity: 0.25,
  opacity: 0.9             // ← Rand transparant
}).bindPopup('<b>Nieuwerkerk gebied</b><br>245 slachtoffers').addTo(map);

L.polygon([
  [51.70, 4.10], [51.72, 4.10], [51.72, 4.20], [51.70, 4.20], [51.70, 4.10]
], {
  color: '#4a90e2',
  weight: 1.5,
  fillColor: '#4a90e2',
  fillOpacity: 0.25,
  opacity: 0.9
}).bindPopup('Tweede rampgebied').addTo(map);

//einde demo



  
// Sober marker icon
const soberIcon = L.divIcon({
  html: '<div style="background:#333; width:8px; height:8px; border-radius:50%; border:1px solid #666;"></div>',
  iconSize: [10, 10],
  iconAnchor: [5, 5],
  popupAnchor: [0, -10],
  className: 'custom-marker'
});

// Dynamische markers
{{ range .Pages }}
  {{ $coords := .Params.coördinaten }}
  {{ if $coords }}
    {{ $parts := split $coords " " }}
    {{ if ge (len $parts) 2 }}
      {{ $lat := (index $parts 0 | strings.TrimSpace | float) }}
      {{ $lng := (index $parts 1 | strings.TrimSpace | float) }}
      {{ if and (ge $lat 50) (le $lat 54) }}
        L.marker([{{$lat}}, {{$lng}}], { icon: soberIcon })
          .bindPopup(`
            <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
            <p>{{ .Params.aantal_slachtoffers | default "?" }} slachtoffers</p>
          `)
          .addTo(map);
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

console.log('Markers toegevoegd: {{ len .Pages }} plaatsen');

function zoomTo(coordsStr) {
  const parts = coordsStr.split(' ');
  if (parts.length >= 2) {
    const lat = parseFloat(parts[0].trim());
    const lng = parseFloat(parts[1].trim());
    map.setView([lat, lng], 14);
  }
}
</script>

<style>
.custom-marker {
  background: none !important;
  border: none !important;
  margin: 0 !important;
}
.plaatsen-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
}
.plaats-card {
  padding: 1.5rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  background: white;
}
.badge {
  background: #e74c3c;
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
}
</style>

{{ end }}
