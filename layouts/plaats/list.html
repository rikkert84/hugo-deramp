{{ define "main" }}
<h1>Plaatsen ({{ len .Pages }})</h1>

<div class="plaatsen-grid">
{{ range .Pages }}
  <div class="plaats-card">
    <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
    {{ if .Params.aantal_slachtoffers }}
      <span class="badge">{{ .Params.aantal_slachtoffers }} slachtoffers</span>
    {{ end }}
    {{ if .Params.co√∂rdinaten }}
      <small>üìç {{ .Params.co√∂rdinaten }}</small>
      <!-- ‚úÖ Fix: index ipv first -->
      <button onclick="zoomTo({{ (split .Params.co√∂rdinaten ',') | index 0 | strings.TrimSpace }}, 
                           {{ (split .Params.co√∂rdinaten ',') | index 1 | strings.TrimSpace }})">
        Zoom
      </button>
    {{ end }}
  </div>
{{ end }}
</div>

<div id="map" style="height:500px;"></div>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([51.5, 3.8], 10);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

{{ range .Pages }}
  {{ if .Params.co√∂rdinaten }}
    {{ $coords := split .Params.co√∂rdinaten "," }}
    {{ $lat := (index $coords 0 | strings.TrimSpace) | float }}
    {{ $lng := (index $coords 1 | strings.TrimSpace) | float }}
    L.marker([{{$lat}}, {{$lng}}]).bindPopup('{{.Title}} ({{.Params.aantal_slachtoffers}})').addTo(map);
  {{ end }}
{{ end }}

function zoomTo(lat, lng) { map.setView([parseFloat(lat), parseFloat(lng)], 14); }
console.log('Markers: {{ len .Pages }}');
</script>
{{ end }}
