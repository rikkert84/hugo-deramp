{{ define "main" }}
<article class="plaats-detail">
  <header class="plaats-header">
    <h1>{{ .Title }}</h1>
    {{ if .Description }}
      <p class="plaats-summary">{{ .Description }}</p>
    {{ end }}
  </header>

  <!-- Plaats info -->
  <div class="plaats-info">
    {{ if .Params.coördinaten }}
      <div id="plaats-map" style="height: 400px; margin: 1.5rem 0;"></div>
    {{ end }}
    
    {{ if .Params.aantal_slachtoffers }}
      <p class="slachtoffers-count">
        <strong>{{ .Params.aantal_slachtoffers }}</strong> slachtoffers
      </p>
    {{ end }}
  </div>

  <!-- Beschrijving -->
  {{ if .Content }}
    <div class="plaats-content">
      {{ .Content }}
    </div>
  {{ end }}

  <!-- Slachtoffers uit deze plaats -->
  <section class="slachtoffers-section">
    <h2>Slachtoffers ({{ len .Data.Pages }})</h2>
    <div class="namen-grid">  <!-- Hergebruik advertentie-stijl! -->
      {{ range .Data.Pages.ByParam "sorteren" }}
        <div class="overlijdens-advertentie">
          <div class="advertentie-inner">
            <h3 class="naam"><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
            <div class="geb">{{ .Params.geboortedatum | time.AsTime | time.Format "2 Jan 2006" }} te {{ .Params.geboorteplaats }}</div>
            <div class="overl">Overleden te {{ .Params.overlijdensplaats }}</div>
          </div>
        </div>
      {{ end }}
    </div>
  </section>

  <div class="plaats-nav">
    <a href="/plaatsen/" class="btn">← Alle plaatsen</a>
  </div>
</article>


{{/* DEBUG KAART */}}
<div style="height: 400px; background: red; color: white; text-align: center; line-height: 400px;">
  TEST: {{ .Params.coördinaten }}<br>
  Lat: {{ .Params.coördinaten | split "," | first | strings.TrimSpace }}<br>
  Aantal pages: {{ len .Data.Pages }}
</div>





{{/* Mini-kaart */}}
{{ if .Params.coördinaten }}
{{ $coords := .Params.coördinaten | split "," }}
{{ $lat := ($coords | index 0 | strings.TrimSpace | float) }}
{{ $lng := ($coords | index 1 | strings.TrimSpace | float) }}

{{ if and (not (eq $lat 0)) (not (eq $lng 0)) }}
<div id="plaats-map" style="height: 400px; margin: 1.5rem 0; border: 1px solid #ccc;"></div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const map = L.map('plaats-map').setView([{{ $lat }}, {{ $lng }}], 14);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);
  
  L.marker([{{ $lat }}, {{ $lng }}])
    .bindPopup('<strong>{{ .Title }}</strong><br>Klik voor details')
    .addTo(map);
  
  console.log('Kaart geladen:', {{ $lat }}, {{ $lng }});
});
</script>
{{ else }}
<p style="color: orange; padding: 1rem; background: #fff3cd;">
  <strong>Kaart niet beschikbaar</strong><br>
  Coördinaten: "{{ .Params.coördinaten }}" (fix formaat: "51.8333, 4.0167")
</p>
{{ end }}
{{ end }}


{{ end }}
{{ end }}
